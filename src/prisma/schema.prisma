// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  //binaryTargets = ["native", "linux-musl-arm64-openssl-3.0.x"]
  binaryTargets = ["native", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  userId      Int @id
  chatId      Int?
  firstname   String?
  lastname    String?
  nickname    String?
  connLimit   Int
  connections Connection[]
}

model Connection {
  id Int    @id @default(autoincrement())
  name   String // key_telegram_id
  server      String
  server_port String
  password    String
  method      String
  access_url  String
  //many-to-one
  user        User?  @relation(fields: [userId], references: [userId])
  userId      Int?
}

model Payment {
  paymentId String @id
  orderId String
  status String @default("PENDING")
  paymentSystem String @default("YOOMONEY")
  userId Int
  chatId Int
  tariffId String
  amount Int
  paymentAt DateTime
  paymentAmount Int
  paymentCurrency String
  description String?
  url String
  monthCount Int
  transactionId String?
  payerAmount String?
  payerCurrency String?
  network String?
  address String?
  from String?
  txid String?
  form String
  isFinal Boolean?
  email String?
}

model Tariff {
  id String @id @unique
  name String
  connectionsLimit Int
  price Int
  @@index([price, connectionsLimit])
}

model SceneStep {
  id Int @id @default(autoincrement())
  scene String
  nextScene String
  date  DateTime @default(now())
}