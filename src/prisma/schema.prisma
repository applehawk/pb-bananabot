// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  //binaryTargets = ["native", "linux-musl-arm64-openssl-3.0.x"]
  binaryTargets = ["native", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  userId      Int @id
  chatId      Int?
  firstname   String?
  lastname    String?
  username    String?
  connLimit   Int
  balance     Int
  connections Connection[]
  createdAt DateTime @default(now())
}

model Connection {
  id          Int @id @default(autoincrement())
  hashId      String
  name        String // key_telegram_id
  server      String
  server_port String
  password    String
  method      String
  access_url  String
  //many-to-one, but not necessary relations
  user        User?  @relation(fields: [userId], references: [userId])
  userId      Int?
  createdAt DateTime @default(now())
}

model Payment {
  paymentId String @id
  orderId String
  status String @default("PENDING")
  paymentSystem String @default("YOOMONEY")
  userId Int
  chatId Int
  tariffId String
  amount Int
  paymentAt DateTime
  paymentAmount Int
  paymentCurrency String
  description String?
  url String
  transactionId String?
  payerAmount String?
  payerCurrency String?
  network String?
  address String?
  from String?
  txid String?
  form String
  isFinal Boolean?
  email String?
}

model Tariff {
  id String @id @unique
  name String
  price Int
  period Int
  caption String
  @@index([price])
}

model BalanceChange {
  id Int @id @default(autoincrement())
  userId Int
  paymentId String?
  balance Int
  changeAmount Int
  type String @default("PAYMENT") // "PAYMENT", "MANUALLY", "SCHEDULER"
  status String // "DONE" / "INSUFFICIENT"
  changeAt DateTime @default(now())
}

model SceneStep {
  id Int @id @default(autoincrement())
  scene String
  nextScene String
  date  DateTime @default(now())
}