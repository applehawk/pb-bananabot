# Makefile - –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

–≠—Ç–æ—Ç —Ñ–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–∞–∏–±–æ–ª–µ–µ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–æ–µ–∫—Ç–æ–º BananaBot.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

```bash
# 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å submodules
git clone --recurse-submodules <repo-url>
cd bananabot

# 2. –ü–æ–ª–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è + –ë–î
make setup-db

# –≠—Ç–æ –≤—ã–ø–æ–ª–Ω–∏—Ç:
# - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é submodules
# - –£—Å—Ç–∞–Ω–æ–≤–∫—É –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –¥–ª—è –±–æ—Ç–∞
# - –£—Å—Ç–∞–Ω–æ–≤–∫—É –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –¥–ª—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
# - –ì–µ–Ω–µ—Ä–∞—Ü–∏—é Prisma Client
# - –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π –ë–î
```

### –ï—Å–ª–∏ —É–∂–µ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–ª–∏ –±–µ–∑ submodules

```bash
# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å submodules
make submodules-init

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
make setup
```

## üê≥ Docker - –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

```bash
# –ü–æ–ª–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç
make docker-up

# –ö–æ—Ä–æ—Ç–∫–∏–π –∞–ª–∏–∞—Å
make up
```

–≠—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç:
- PostgreSQL (–ø–æ—Ä—Ç 5432)
- Redis (–ø–æ—Ä—Ç 6379)
- Telegram Bot (–ø–æ—Ä—Ç 3000)
- Admin Panel (–ø–æ—Ä—Ç 3001)

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤

```bash
# –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã
make logs

# –ò–ª–∏ –Ω–∞–ø—Ä—è–º—É—é
docker-compose logs -f

# –¢–æ–ª—å–∫–æ –±–æ—Ç
docker-compose logs -f bot

# –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
docker-compose logs -f admin
```

### –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ
make down

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏ —É–¥–∞–ª–∏—Ç—å volumes (‚ö†Ô∏è —É–¥–∞–ª–∏—Ç –¥–∞–Ω–Ω—ã–µ –ë–î)
docker-compose down -v
```

### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫

```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
make docker-restart

# –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑—ã –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å –∑–∞–Ω–æ–≤–æ
make docker-build
make up
```

### –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤

```bash
make ps
```

## üíª –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ (–±–µ–∑ Docker)

### –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞

```bash
# Development —Ä–µ–∂–∏–º (—Å hot reload)
make dev

# Production —Ä–µ–∂–∏–º
make start
```

### –ó–∞–ø—É—Å–∫ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏

```bash
# Development —Ä–µ–∂–∏–º (–ø–æ—Ä—Ç 3001)
make admin-dev

# Production —Ä–µ–∂–∏–º —á–µ—Ä–µ–∑ Docker
make admin-prod
```

## üóÑÔ∏è –†–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Prisma Client

```bash
make db-generate
```

–ó–∞–ø—É—Å–∫–∞–π—Ç–µ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ `prisma/schema.prisma`.

### –°–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏

```bash
# –°–æ–∑–¥–∞—Ç—å –∏ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
make db-migrate

# –í –ø—Ä–æ—Ü–µ—Å—Å–µ –≤–∞—Å –ø–æ–ø—Ä–æ—Å—è—Ç –≤–≤–µ—Å—Ç–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏
```

### Prisma Studio (GUI –¥–ª—è –ë–î)

```bash
make db-studio
```

–û—Ç–∫—Ä–æ–µ—Ç—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ –Ω–∞ `http://localhost:5555`

### Push —Å—Ö–µ–º—ã –±–µ–∑ –º–∏–≥—Ä–∞—Ü–∏–∏ (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)

```bash
make db-push
```

‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏! –î–ª—è production –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏.

### –°–±—Ä–æ—Å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
make db-reset
```

‚ö†Ô∏è **–í–ù–ò–ú–ê–ù–ò–ï**: –≠—Ç–æ —É–¥–∞–ª–∏—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ!

## üì¶ –†–∞–±–æ—Ç–∞ —Å Submodules

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞

```bash
make submodules-status
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ submodules

```bash
# –û–±–Ω–æ–≤–∏—Ç—å –¥–æ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∫–æ–º–º–∏—Ç–æ–≤
make submodules-update

# –ò–ª–∏ pull –∏–∑–º–µ–Ω–µ–Ω–∏–π
make submodules-pull
```

### –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ submodule

```bash
# 1. –ü–µ—Ä–µ–π—Ç–∏ –≤ submodule
cd prisma  # –∏–ª–∏ bananabot-admin

# 2. –í–Ω–µ—Å—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏ –∑–∞–∫–æ–º–º–∏—Ç–∏—Ç—å
git add .
git commit -m "feat: my changes"
git push origin main

# 3. –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –æ—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ–µ–∫—Ç
cd ..

# 4. –û–±–Ω–æ–≤–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ submodule
git add prisma
git commit -m "chore: update prisma submodule"
git push
```

## üîó Webhook (Telegram)

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ webhook

```bash
make webhook-set
```

‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π `DOMAIN` –≤ `.env`

### –£–¥–∞–ª–µ–Ω–∏–µ webhook

```bash
make webhook-delete
```

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –Ω–∞ polling —Ä–µ–∂–∏–º.

## üßπ –û—á–∏—Å—Ç–∫–∞

### –õ–µ–≥–∫–∞—è –æ—á–∏—Å—Ç–∫–∞

```bash
make clean
```

–£–¥–∞–ª—è–µ—Ç:
- `dist/`
- –ö–µ—à —Ñ–∞–π–ª—ã
- –õ–æ–≥–∏

### –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞

```bash
make clean-all
```

–£–¥–∞–ª—è–µ—Ç –≤—Å–µ + `node_modules/`

### –ß–∏—Å—Ç–∞—è –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
make fresh
```

–í—ã–ø–æ–ª–Ω—è–µ—Ç:
1. `make clean-all`
2. `make install`
3. `make build`

## üöÄ –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –ü–æ–ª–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
make setup
```

–í—ã–ø–æ–ª–Ω—è–µ—Ç:
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ submodules
- –£—Å—Ç–∞–Ω–æ–≤–∫—É –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –±–æ—Ç–∞
- –£—Å—Ç–∞–Ω–æ–≤–∫—É –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ + –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

```bash
make setup-db
```

–í—ã–ø–æ–ª–Ω—è–µ—Ç –≤—Å–µ –∏–∑ `setup` –ø–ª—é—Å:
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—é Prisma Client
- –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π

### –ü–æ–ª–Ω–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –≤ Docker

```bash
make deploy
```

–í—ã–ø–æ–ª–Ω—è–µ—Ç:
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ submodules
- –ü–µ—Ä–µ—Å–±–æ—Ä–∫—É Docker –æ–±—Ä–∞–∑–æ–≤
- –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

## üìù –¢–∏–ø–∏—á–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

```bash
# 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å
git clone --recurse-submodules <repo-url>
cd bananabot

# 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å .env
cp .env.example .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å —á–µ—Ä–µ–∑ Docker
make deploy

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
make ps
make logs
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å hot reload

```bash
# 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —Å–¥–µ–ª–∞–Ω–æ)
make setup-db

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ë–î –≤ Docker
docker-compose up -d postgres redis

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞ –ª–æ–∫–∞–ª—å–Ω–æ
make dev

# 4. –í –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ - –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
make admin-dev
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ pull

```bash
# 1. Pull –∏–∑–º–µ–Ω–µ–Ω–∏–π
git pull origin main

# 2. –û–±–Ω–æ–≤–∏—Ç—å submodules
make submodules-update

# 3. –û–±–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
npm install
cd bananabot-admin && pnpm install && cd ..

# 4. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å)
make db-migrate

# 5. –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å
make build

# 6. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å (–µ—Å–ª–∏ –≤ Docker)
make docker-restart
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ö–µ–º—ã –ë–î

```bash
# 1. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å prisma/schema.prisma
# ...

# 2. –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
make db-migrate
# –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä: "add_user_avatar"

# 3. –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å Prisma Client
make db-generate

# 4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
make restart  # –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ
# –∏–ª–∏
make docker-restart  # –¥–ª—è Docker
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 5: –û—Ç–ª–∞–¥–∫–∞ –ø—Ä–æ–±–ª–µ–º

```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
make logs

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
make ps

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ë–î —á–µ—Ä–µ–∑ Prisma Studio
make db-studio

# 4. –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
make clean-all
make setup-db

# 5. –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ —Å Docker
make down
docker system prune -a  # ‚ö†Ô∏è —É–¥–∞–ª–∏—Ç –≤—Å–µ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –æ–±—Ä–∞–∑—ã
make deploy
```

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

- –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥: `make help`
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: [README.md](README.md)
- Docker —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ: [DOCKER_DEPLOYMENT.md](DOCKER_DEPLOYMENT.md)
- Amvera —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ: [AMVERA_DEPLOYMENT.md](AMVERA_DEPLOYMENT.md)
- Submodules: [SUBMODULES_GUIDE.md](SUBMODULES_GUIDE.md)
