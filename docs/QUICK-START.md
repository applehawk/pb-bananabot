# –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

–≠—Ç–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ–º–æ–∂–µ—Ç –≤–∞–º –∑–∞–ø—É—Å—Ç–∏—Ç—å BananaBot –∑–∞ 5 –º–∏–Ω—É—Ç.

## –ß—Ç–æ –≤–∞–º –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è

- Node.js >= 18.0.0
- npm >= 9.0.0
- Telegram Bot Token –æ—Ç [@BotFather](https://t.me/BotFather)
- (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) YooMoney –∞–∫–∫–∞—É–Ω—Ç –¥–ª—è –ø—Ä–∏—ë–º–∞ –ø–ª–∞—Ç–µ–∂–µ–π

## –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π (–µ—Å–ª–∏ –µ—â—ë –Ω–µ —Å–¥–µ–ª–∞–ª–∏)
git clone <your-repo-url>
cd bananabot_rewriting_vpnssconf

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
npm install
```

## –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```bash
cp .env.example .env
```

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `.env`:

```env
# –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
BOT_TOKEN=your_telegram_bot_token_here
ADMIN_CHAT_ID=your_telegram_user_id
DATABASE_URL=file:./src/prisma/dev.db

# –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ (–º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
PORT=80
NODE_ENV=development
MINIMUM_BALANCE=3

# –î–ª—è –ø—Ä–∏—ë–º–∞ –ø–ª–∞—Ç–µ–∂–µ–π (–Ω–∞—Å—Ç—Ä–æ–∏—Ç–µ –ø–æ–∑–∂–µ)
YOOMONEY_SECRET=your_yoomoney_secret
DOMAIN=https://your-domain.com
```

### –ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å BOT_TOKEN?

1. –ù–∞–π–¥–∏—Ç–µ [@BotFather](https://t.me/BotFather) –≤ Telegram
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/newbot`
3. –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω –≤ `.env`

### –ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å ADMIN_CHAT_ID?

1. –ù–∞–π–¥–∏—Ç–µ [@userinfobot](https://t.me/userinfobot) –≤ Telegram
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/start`
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤–∞—à ID –≤ `.env`

## –®–∞–≥ 3: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
# –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å Prisma Client
npm run prisma:generate

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
npm run prisma:migrate
```

## –®–∞–≥ 4: –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞

```bash
npm run start:dev
```

–í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:

```
[Nest] INFO  [NestFactory] Starting Nest application...
[Nest] INFO  [GrammYService] Bot started successfully in polling mode
```

## –®–∞–≥ 5: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. –ù–∞–π–¥–∏—Ç–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞ –≤ Telegram
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/start`
3. –í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ

–ì–æ—Ç–æ–≤–æ! –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω! üéâ

---

## –ß—Ç–æ –¥–∞–ª—å—à–µ?

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–∞—Ä–∏—Ñ–æ–≤

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç —Ç–∞—Ä–∏—Ñ–æ–≤. –î–æ–±–∞–≤—å—Ç–µ –∏—Ö:

1. –û—Ç–∫—Ä–æ–π—Ç–µ Prisma Studio:
   ```bash
   npm run prisma:studio
   ```

2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ç–∞–±–ª–∏—Ü—É `Tariff`

3. –î–æ–±–∞–≤—å—Ç–µ —Ç–∞—Ä–∏—Ñ—ã:
   ```
   id: MONTH_TARIFF
   name: 1 –º–µ—Å—è—Ü
   price: 300
   period: 30
   caption: –î–æ—Å—Ç—É–ø –Ω–∞ 30 –¥–Ω–µ–π
   ```

   ```
   id: THREEMONTH_TARIFF
   name: 3 –º–µ—Å—è—Ü–∞
   price: 800
   period: 90
   caption: –î–æ—Å—Ç—É–ø –Ω–∞ 90 –¥–Ω–µ–π
   ```

   ```
   id: SIXMONTH_TARIFF
   name: 6 –º–µ—Å—è—Ü–µ–≤
   price: 1500
   period: 180
   caption: –î–æ—Å—Ç—É–ø –Ω–∞ 180 –¥–Ω–µ–π
   ```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π YooMoney

1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ [YooMoney](https://yoomoney.ru/)
2. –ü–æ–ª—É—á–∏—Ç–µ —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è webhook
3. –î–æ–±–∞–≤—å—Ç–µ –≤ `.env`:
   ```env
   YOOMONEY_SECRET=your_secret_key
   DOMAIN=https://your-domain.com
   ```

4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ webhook –Ω–∞ YooMoney:
   ```
   URL: https://your-domain.com/payment/yoomoney/notification
   ```

### –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ

#### –î–æ–±–∞–≤–∏—Ç—å –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

```
/up @username 100
```

–î–æ–±–∞–≤–∏—Ç 100‚ÇΩ –∫ –±–∞–ª–∞–Ω—Å—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è `@username`.

#### –ò–∑–º–µ–Ω–∏—Ç—å —Ü–µ–Ω—É —Ç–∞—Ä–∏—Ñ–∞

```
/tariff MONTH_TARIFF 350
```

–£—Å—Ç–∞–Ω–æ–≤–∏—Ç —Ü–µ–Ω—É –º–µ—Å—è—á–Ω–æ–≥–æ —Ç–∞—Ä–∏—Ñ–∞ –≤ 350‚ÇΩ.

---

## –ö–æ–º–∞–Ω–¥—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

```bash
# Development —Ä–µ–∂–∏–º (—Å –∞–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–æ–π)
npm run start:dev

# Production —Ä–µ–∂–∏–º
npm run build:grammy
npm run start:prod

# Prisma Studio (GUI –¥–ª—è –ë–î)
npm run prisma:studio

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞
npm run lint

# –¢–µ—Å—Ç—ã
npm run test
```

---

## Production Deployment

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ webhook

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è
export NODE_ENV=production

# –ù–∞—Å—Ç—Ä–æ–π—Ç–µ webhook
npm run webhook:set
```

### 2. –ó–∞–ø—É—Å–∫

```bash
# –°–æ–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç
npm run build:grammy

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å –º–∏–≥—Ä–∞—Ü–∏—è–º–∏
npm run start:migrate:prod
```

–ë–æ—Ç –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –≤ webhook —Ä–µ–∂–∏–º–µ –Ω–∞ `https://your-domain.com/telegram/webhook`.

---

## Troubleshooting

### –ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç

**–ü—Ä–æ–±–ª–µ–º–∞:** –ë–æ—Ç –Ω–µ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ `/start`

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `BOT_TOKEN` –≤ `.env`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –±–æ—Ç –∑–∞–ø—É—â–µ–Ω: `npm run start:dev`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è

**–ü—Ä–æ–±–ª–µ–º–∞:** `Error: Can't find Prisma Client`

**–†–µ—à–µ–Ω–∏–µ:**
```bash
npm run prisma:generate
npm run prisma:migrate
```

### –ü–æ—Ä—Ç –∑–∞–Ω—è—Ç

**–ü—Ä–æ–±–ª–µ–º–∞:** `Error: listen EADDRINUSE: address already in use :::80`

**–†–µ—à–µ–Ω–∏–µ:**
–ò–∑–º–µ–Ω–∏—Ç–µ –ø–æ—Ä—Ç –≤ `.env`:
```env
PORT=3000
```

### –û—à–∏–±–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏

**–ü—Ä–æ–±–ª–µ–º–∞:** `Migration failed`

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –°–±—Ä–æ—Å—å—Ç–µ –ë–î (–í–ù–ò–ú–ê–ù–ò–ï: —É–¥–∞–ª–∏—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ)
rm src/prisma/dev.db
npm run prisma:migrate
```

---

## –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [README-GRAMMY.md](README-GRAMMY.md) - –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [PAYMENT-WORKFLOW.md](PAYMENT-WORKFLOW.md) - –õ–æ–≥–∏–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π
- [PROJECT-STRUCTURE.md](PROJECT-STRUCTURE.md) - –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
- [grammY Docs](https://grammy.dev) - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è grammY
- [NestJS Docs](https://nestjs.com) - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è NestJS

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–º–∞–Ω–¥ –±–æ—Ç–∞

### –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

- `/start` - –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
- –ö–Ω–æ–ø–∫–∞ "–°—Ç–∞—Ç—É—Å" - –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –±–∞–ª–∞–Ω—Å
- –ö–Ω–æ–ø–∫–∞ "–ü–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø" - –í—ã–±—Ä–∞—Ç—å —Ç–∞—Ä–∏—Ñ
- –ö–Ω–æ–ø–∫–∞ "–í–æ–ø—Ä–æ—Å—ã" - –ü–æ–º–æ—â—å

### –î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤

- `/up <username> <amount>` - –ò–∑–º–µ–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å
- `/tariff <name> <price>` - –ò–∑–º–µ–Ω–∏—Ç—å —Ü–µ–Ω—É —Ç–∞—Ä–∏—Ñ–∞
- `/setmenu` - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–µ–Ω—é –±–æ—Ç–∞

---

## –¢–∏–ø–∏—á–Ω—ã–π workflow

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø—É—Å–∫–∞–µ—Ç –±–æ—Ç–∞**
   - `/start` ‚Üí –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å –±–∞–ª–∞–Ω—Å–æ–º 0‚ÇΩ

2. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç —Ç–∞—Ä–∏—Ñ**
   - "–ü–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø" ‚Üí –í—ã–±–æ—Ä —Ç–∞—Ä–∏—Ñ–∞ (1/3/6 –º–µ—Å—è—Ü–µ–≤)

3. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–ø–ª–∞—á–∏–≤–∞–µ—Ç**
   - –ü–æ–ª—É—á–∞–µ—Ç —Å—Å—ã–ª–∫—É –Ω–∞ YooMoney
   - –û–ø–ª–∞—á–∏–≤–∞–µ—Ç –∫–∞—Ä—Ç–æ–π
   - –ë–∞–ª–∞–Ω—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ø–æ–ª–Ω—è–µ—Ç—Å—è

4. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–ø–∏—Å–∞–Ω–∏–µ**
   - –ö–∞–∂–¥—É—é –ø–æ–ª–Ω–æ—á—å —Å–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è `MINIMUM_BALANCE`
   - –ï—Å–ª–∏ –±–∞–ª–∞–Ω—Å–∞ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ - –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ

5. **–ê–¥–º–∏–Ω —É–ø—Ä–∞–≤–ª—è–µ—Ç**
   - –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –æ–ø–ª–∞—Ç–∞—Ö
   - –í—Ä—É—á–Ω—É—é –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ—Ç –±–∞–ª–∞–Ω—Å –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
   - –ò–∑–º–µ–Ω—è–µ—Ç —Ü–µ–Ω—ã —Ç–∞—Ä–∏—Ñ–æ–≤

---

**–ì–æ—Ç–æ–≤–æ!** –¢–µ–ø–µ—Ä—å —É –≤–∞—Å –µ—Å—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—á–∏–π Telegram –±–æ—Ç —Å –ø–ª–∞—Ç–µ–∂–∞–º–∏! üöÄ

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –≤–æ–ø—Ä–æ—Å—ã - —Å–º. [README-GRAMMY.md](README-GRAMMY.md) –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.
